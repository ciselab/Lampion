version: '3.8'

services:
  {% for config in configurations -%}
  CodeBert_CodeToText_Experiment_{{ config.run_number }}:
    image: ciselab/codebert-code2text:latest
    volumes:
      - ./{{ config.path }}/dataset/:/dataset:ro
      - ./{{ config.path }}/experiment_output:/experiment/output
      - ./models:/models
    environment:
      test_file: /dataset/preprocessed_test_java.jsonl
      do_train: "false"
      do_val: "false"
      pretrained_model: /models/model.bin
      MANIFEST_PATH: /usr/app/obfuscator_output/manifest/TransformationManifest.db
      batch_size: {{batch_size|default(8,true)}}
    oom_kill_disable: true
  
  {% endfor %}